{% extends "layout.html" %}
{% block main %}

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: 'Ubuntu', sans-serif;
    }

    .map-overlay {
        font: 14px/20px;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        padding: 0;
        z-index: 2;
        text-align: center;
    }

    .map-overlay-inner {
        background-color: rgba(0, 0, 0, 0.6);
        padding: 10px;
        border-radius: 3px;
        box-shadow: 2px 4px 8px rgba(0, 0, 0, 0.2);
    }

    .map-overlay-inner fieldset {
        border: none;
        padding: 0;
        margin: 0 0 10px;
        text-align: left;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .map-overlay-inner fieldset:last-child {
        margin: 0;
        text-align: center;
    }

    .map-overlay-inner select {
        width: auto;
        flex-grow: 1;
    }

    .map-overlay-inner label {
        margin-right: 10px;
        white-space: nowrap;
    }

    .map-overlay-inner button {
        display: inline-block;
        width: 20px;
        height: 5px;
        border: none;
    }

    .map-overlay-inner button:focus {
        outline: none;
    }

    .custom-popup {
        font-size: 16px;
        padding: 10px;
        width: 200px;
        color: #000000;
        margin: 0;
    }

    label[for="layer"] {
        color: white;
    }

    #detail-right {
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
    }

    #detail-left .list-group-item {
        border: none;
    }

    .list-group-item strong {
        text-decoration: underline;
        text-decoration-thickness: 3px;
        font-weight: bold;
    }

    .map-pop {
        background: #0b72b7;
        border-radius: 2px;
        color: #fff;
        position: absolute;
        top: 257px;
        left: 193px;
        width: 93px;
        height: 54px;
        text-align: center;
        font: 13px/15px "Ubuntu", sans-serif;
        padding: 7px 10px 0 10px;
        opacity: 1;
        visibility: visible;
        transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .map-pop.hide {
        visibility: hidden;
    }

    .map-pop:after {
        top: 100%;
        border: solid transparent;
        content: " ";
        height: 0;
        width: 0;
        position: absolute;
        pointer-events: none;
    }

    .map-pop:after {
        border-color: rgba(11, 114, 183, 0);
        border-top-color: #0b72b7;
        border-width: 10px;
        left: 50%;
        margin-left: -10px;
    }

    .table {
        table-layout: fixed;
        width: 100%;
        margin-bottom: 1rem;
        color: #212529;
        border-collapse: collapse;
    }
    .table th,
    .table td {
        padding: 0.75rem;
        vertical-align: middle;
        border-top: 1px solid #dee2e6;
    }
    .category-title th {
        background-color: #f8f9fa;
        font-size: 1.2em;
        font-weight: bold;
    }
    .category-header td,
    .subcategory-header td {
        background-color: #e9ecef;
        font-weight: bold;
    }
    .state-section {
        margin-bottom: 2rem;
    }

    .category-description {
        margin-bottom: 1rem;
        font-style: italic;
        color: #6c757d;
        background-color: #f8f9fa;
    }

    .category-description td {
        padding-top: 0;
    }

    .table td.text-truncate {
        max-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .table th:last-child,
    .table td:last-child {
        width: 100px;
        text-align: right;
    }

    .table th:nth-child(2),
    .table td:nth-child(2) {
        width: 100px;
        text-align: center;
    }

    .table tr:first-child th,
    .table tr:nth-child(2) td {
        text-align: left;
    }

    .btn-info {
        width: 100px;
    }

    .text-wrap {
        white-space: normal;
        word-wrap: break-word;
        max-width: 300px; /* Adjust this value as needed */
    }

    .candidate-names {
        max-height: 100px; /* Adjust this value as needed */
        overflow-y: auto;
    }

    /* Ensure the table doesn't become too wide */
    .table {
        max-width: 100%;
    }
</style>

<body>
    <div class="row" height="100%">
        <div class="col" id="detail-left">
            <ul class="list-group" id="state-data-list">
                <!-- State data will be dynamically inserted here -->
            </ul>
        </div>
        
    <div class="col" id="detail-right" >
            <div class="map-overlay">
                    <div class="map-overlay-inner">
                          <fieldset>
                            <label for="layer">Currently viewing: </label>
                            <select id="layer" name="layer">
                                <option value="empty">choose</option>
                                <option value="ballot_vpm">Democracy ballot initiatives</option>
                                <option value="presidential2" >Presidential race</option>
                                <option value="congressional2">Senate race</option>
                                <option value="house2" selected>House races</option>
                                <option value="state_leg_up">State upper legislature</option>
                                <option value="state_leg_low">State lower legislature</option>
                                <option value="ballot_abort">Reproductive rights initiatives</option>
                                <option value="ballot_others">State-level ballot issues</option>
                            </select>
                        </fieldset>
                    </div>
                    
                    <div class="col map-container-sm">
                        <div id="map"></div>
                        <div class="map-pop">
                            Mouseover for more info
                        </div>
                       
                    </div> 
                   
            </div>       
        </div>
     
</div>
<script>

    // Create a master dictionary to hold all state data
    let masterStateData = {};

    // Function to add data to the master dictionary
    function addToMasterData(dataList, category) {
        // Use empty array if dataList is falsy (null, undefined, or empty)
        const items = dataList || [];
        
        items.forEach(item => {
            const state = item.state || item.state_name || 'Unknown';
            if (!masterStateData[state]) {
                masterStateData[state] = {};
            }
            if (!masterStateData[state][category]) {
                masterStateData[state][category] = [];
            }
            // Use spread operator to add new items
            masterStateData[state][category] = [...masterStateData[state][category], item];
        });

        // Ensure category exists even if dataList was empty
        Object.keys(masterStateData).forEach(state => {
            if (!masterStateData[state][category]) {
                masterStateData[state][category] = [];
            }
        });
    }

    // Process each data list
    addToMasterData({{ pres_list | tojson | safe }}, 'presidential');
    addToMasterData({{ senate_list | tojson | safe }}, 'senate');
    addToMasterData({{ house_list | tojson | safe }}, 'house');
    addToMasterData({{ state_house_list | tojson | safe }}, 'state_house');
    addToMasterData({{ state_senate_list | tojson | safe }}, 'state_senate');
    addToMasterData({{ governor_list | tojson | safe }}, 'governor');
    addToMasterData({{ dem_ballot_list | tojson | safe }}, 'democracy_repair_ballots');
    addToMasterData({{ state_level_list | tojson | safe }}, 'state_level_ballots');

    console.log('Master State Data:', masterStateData);

    // Optional: Count the number of states
    const totalStates = Object.keys(masterStateData).length;
    console.log('Total number of states:', totalStates);

    // Optional: Log a summary of data for each state
    for (const state in masterStateData) {
        console.log(`${state}:`, Object.keys(masterStateData[state]).join(', '));
    }

    function createCategoryList(categoryData, categoryTitle) {
        console.log('Category Data:', categoryData);
        if (!categoryData || categoryData.length === 0) return '';
        
        let tableRows = '';
        let description = '';

        switch (categoryTitle) {
            case 'Democracy Ballot Initiatives':
                description = `<p class="category-description">These initiatives make long-term changes to the practice of democracy in this state.</p>`;
                tableRows = categoryData.map(item => `
                    <tr>
                        <td class="text-wrap" colspan="2">
                            <div class="candidate-names">${item.candidate_names || ''}</div>
                        </td>
                        <td><button class="btn btn-sm btn-info">Learn More</button></td>
                    </tr>
                `).join('');
                break;
            case 'Elected Offices':
                description = `<p class="category-description">Elected offices where the power of individual voters is high:</p>`;
                tableRows = '';
                
                if (categoryData.president && categoryData.president.voter_power > 20) {
                    tableRows += `
                        <tr>
                            <td>President</td>
                            <td>${Math.round(categoryData.president.voter_power)}</td>
                            <td><button class="btn btn-sm btn-info">Learn More</button></td>
                        </tr>
                    `;
                }
                
                if (categoryData.senate && categoryData.senate.voter_power > 20) {
                    tableRows += `
                        <tr>
                            <td>Senate</td>
                            <td>${Math.round(categoryData.senate.voter_power)}</td>
                            <td><button class="btn btn-sm btn-info">Learn More</button></td>
                        </tr>
                    `;
                }
                
                const highPowerHouseDistricts = categoryData.house.filter(item => item.voter_power > 20);
                
                if (highPowerHouseDistricts.length > 0) {
                    tableRows += `<tr class="subcategory-header"><td colspan="3">U.S. House</td></tr>`;
                    tableRows += highPowerHouseDistricts.map(item => `
                        <tr>
                            <td>${item.election_name.replace(/^Congressional\s*/, '').trim() || 'N/A'}</td>
                            <td>${Math.round(item.voter_power)}</td>
                            <td><button class="btn btn-sm btn-info">Learn More</button></td>
                        </tr>
                    `).join('');
                }
                
                const highPowerStateSenateDistricts = categoryData.state_senate.filter(item => item.voter_power > 20);
                
                if (highPowerStateSenateDistricts.length > 0) {
                    tableRows += `<tr class="subcategory-header"><td colspan="3">State Senate</td></tr>`;
                    tableRows += highPowerStateSenateDistricts.map(item => `
                        <tr>
                            <td>${item.election_name.replace(/^State Senate\s*/, '').trim() || 'N/A'}</td>
                            <td>${Math.round(item.voter_power)}</td>
                            <td><button class="btn btn-sm btn-info">Learn More</button></td>
                        </tr>
                    `).join('');
                }
                
                const highPowerStateHouseDistricts = categoryData.state_house.filter(item => item.voter_power > 20);
                
                if (highPowerStateHouseDistricts.length > 0) {
                    tableRows += `<tr class="subcategory-header"><td colspan="3">State House</td></tr>`;
                    tableRows += highPowerStateHouseDistricts.map(item => `
                        <tr>
                            <td>${item.election_name.replace(/^State House\s*/, '').trim() || 'N/A'}</td>
                            <td>${Math.round(item.voter_power)}</td>
                            <td><button class="btn btn-sm btn-info">Learn More</button></td>
                        </tr>
                    `).join('');
                }
                
                // If no offices have voter power > 20, add a message
                if (tableRows === '') {
                    tableRows = `<tr><td colspan="3">No offices in this state currently have high voter power.</td></tr>`;
                }
                
                break;
        }

        // Determine column headers based on category
        let columnHeaders = '';
        if (categoryTitle === 'Democracy Ballot Initiatives') {
            columnHeaders = `
                <tr>
                    <th colspan="2">Name</th>
                    <th>Action</th>
                </tr>
            `;
        } else {
            columnHeaders = `
                <tr>
                    <th>Name</th>
                    <th>Voter Power</th>
                    <th>Action</th>
                </tr>
            `;
        }

        return `
            <table class="table">
                <thead>
                    <tr class="category-title">
                        <th colspan="3">${categoryTitle}</th>
                    </tr>
                    <tr class="category-description">
                        <td colspan="3">${description}</td>
                    </tr>
                    ${columnHeaders}
                </thead>
                <tbody>
                    ${tableRows}
                </tbody>
            </table>
        `;
    }

    function populateStateList() {
        const stateDataList = document.getElementById('state-data-list');
        stateDataList.innerHTML = ''; // Clear existing content

        for (const state in masterStateData) {
            const stateData = masterStateData[state];
            let stateHtml = `<div class="state-section" id="state-${state.toLowerCase().replace(/\s+/g, '-')}">
                <h3>${state}</h3>`;

            stateHtml += createCategoryList(stateData.democracy_repair_ballots, 'Democracy Ballot Initiatives');
            stateHtml += createCategoryList({
                president: stateData.presidential[0],
                senate: stateData.senate[0],
                house: stateData.house,
                state_senate: stateData.state_senate,
                state_house: stateData.state_house
            }, 'Elected Offices');

            stateHtml += `</div>`;
            stateDataList.innerHTML += stateHtml;
        }
    }

    // Call the function to populate the list
    populateStateList();
</script>          

     
                <script>
                    mapboxgl.accessToken = '{{ mapbox_key }}';
                    const map = new mapboxgl.Map({
                        container: 'map',
                        style: 'mapbox://styles/mikeklein1/clxkrmlob01s801qkb96q6c00',
                        center: ['{{ long }}', '{{ lat }}'],  
                        zoom: 5,  
                        projection: 'mercator'
                    });
                
        const layers = {
            
            //presidential: JSON.parse('{{ pres_layer | safe }}'), 
            //congressional: JSON.parse('{{ senate_layer | safe }}'),
            //house: JSON.parse('{{house_layer | safe }}'),
            presidential2: 'static/data/calculated_files/geojsons/president.geojson',
            congressional2: 'static/data/calculated_files/geojsons/senate.geojson',
            house2: 'static/data/geojson_imports/geojson_final/house.geojson',
           // gubernatorial: 'static/data/calculated_files/geojsons/governor.geojson',
            ballot_abort: 'static/data/geojson_imports/geojson_final/ballot_abort.geojson',
            ballot_vpm: 'static/data/geojson_imports/geojson_final/ballot_VPM.geojson',
            //ballot_sg: 'static/data/geojson_imports/geojson_final/ballot_sg.geojson',
            ballot_others: 'static/data/geojson_imports/geojson_final/ballot_other.geojson',
            state_leg_up:'static/data/geojson_imports/geojson_final/state_leg_upper.geojson',
            state_leg_low:'static/data/geojson_imports/geojson_final/state_leg_lower.geojson'
        };

        const senateList = {{senate_list | tojson}};
        console.log(senateList);


        let hoveredStateId = null; // This will hold the ID of the feature under the mouse.
        let currentLayerId = 'ballot_vpm'; // Track the current layer

        const popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });
        

        function addGeoJsonLayer(layerId) {
            const idProperty = layerId === 'house2' || 'state_leg_up' || 'state_leg_low' ? 'GEOIDFQ' : 'STATEFP';  //  'house' uses GEOIDFQ, others use STATEFP for unique id

            // Clear hover state when switching layers
            if (hoveredStateId) {
                map.setFeatureState({source: currentLayerId, id: hoveredStateId}, { hover: false });
                hoveredStateId = null;
            }

            // Remove existing layers
            if (map.getSource(currentLayerId)) {
                map.removeLayer(currentLayerId + '-fill');
                map.removeLayer(currentLayerId + '-line');
                map.removeLayer(currentLayerId + '-hover-line');  // Remove hover line if it exists
                map.removeSource(currentLayerId);
            }

            currentLayerId = layerId; // Update current layer ID

    // Define colors for each of the new layers
         const colorMapping = {
                'ballot_abort': '#f88',
                'ballot_vpm': '#8f8',
                'ballot_sg': '#88f',
                'ballot_others': '#ff8'
         };

            // Add  layers
            map.addSource(layerId, {
                type: 'geojson',
                data: layers[layerId],
                promoteId: idProperty  
            });

            map.addLayer({
    id: layerId + '-fill',
    type: 'fill',
    source: layerId,
    paint: {
        'fill-color': [
            'case',
            ['==', layerId, 'ballot_abort'], ['match', ['get', 'dropdown.type'], 'abortion', '#F768A0', '#D3D3D3'],
            ['==', layerId, 'ballot_vpm'], ['match', ['get', 'dropdown.type'], 'voting policy measure', '#9277DE', '#D3D3D3'],
            //['==', layerId, 'ballot_sg'], ['match', ['get', 'dropdown.type'], 'state government', '#9E9AC8', '#D3D3D3'],
            //ballot_others now includes governor, state government ballots and liberty ballots
            ['==', layerId, 'ballot_others'], ['match', ['get', 'data'], 'has data', '#D19E9B', '#D3D3D3'],

            ['==', ['get', 'voter_power'], null], '#D3D3D3', // Handles null or undefined voter_power
            ['==', ['get', 'voter_power'], 0], '#D3D3D3', // Handles zero voter_power
            ['==', layerId, 'presidential2'], ['interpolate', ['linear'], ['get', 'voter_power'], 1, '#feedde', 33.3, '#fdbe85', 66.6, '#EF6548', 100, '#D7301F'],
            ['==', layerId, 'congressional2'], ['interpolate', ['linear'], ['get', 'voter_power'], 1, '#fff5e0', 33.3, '#ffebb5', 66.6, '#ffe082', 100, '#fec548'],
            ['==', layerId, 'house2'], ['interpolate', ['linear'], ['get', 'voter_power'], 1, '#F6FAFC', 33.3, '#E3EEF5', 66.6, '#D1E2ED', 100, '#B4CDE3'],
           // ['==', layerId, 'gubernatorial'], ['interpolate', ['linear'], ['get', 'voter_power'], 1, '#fffac2', 33.3, '#fff68f', 66.6, '#fff25c', 100, '#ffdc09'],
            ['==', layerId, 'state_leg_up'], ['interpolate', ['linear'], ['get', 'voter_power'],1, '#ffffcc', 33.3, '#a1dab4', 66.6, '#41b6c4', 100, '#225ea8'],
            ['==', layerId, 'state_leg_low'], ['interpolate', ['linear'], ['get', 'voter_power'],1, '#f1eef6', 33.3, '#d7b5d8', 66.6, '#df65b0', 100, '#ce1256'],
             // Color abortion ballots pink, others grey
            '#D3D3D3'  // Default color if no conditions are met
        ],
        'fill-opacity': 1
    }
}, 'state-label');




            // line layer should be black as default
            map.addLayer({
                id: layerId + '-line',
                type: 'line',
                source: layerId,
                layout: {},
                paint: {
                    'line-color': '#808080',
                    'line-width': .7,
                    'line-opacity': .8
                }
            });

            // add line layer that highlights when hovering 
            map.addLayer({
                id: layerId + '-hover-line',
                type: 'line',
                source: layerId,
                layout: {},
                paint: {
                    'line-color': ['case', ['boolean', ['feature-state', 'hover'], false], '#ffffff', '#000'],
                    'line-width': ['case', ['boolean', ['feature-state', 'hover'], false], 4, 2],
                    'line-opacity': ['case', ['boolean', ['feature-state', 'hover'], false], 1, 0]
                }
            });

            // put hover line  above others
            map.moveLayer(layerId + '-hover-line');

            map.on('mouseenter', layerId + '-fill',(e) => {
                const mapPop = document.querySelector('.map-pop');
                console.log(mapPop);
                if (mapPop && !mapPop.classList.contains('hide')) {
                    mapPop.classList.add('hide');
                }
            });

            // mouse event for hovering
            map.on('mousemove', layerId + '-fill', function (e) {
                if (e.features.length > 0) {
                    const feature = e.features[0];
                    const currentId = feature.properties[idProperty];  // Make sure this is the field you promote as ID

                   // console.log("Feature ID:", feature.id, "Current ID:", currentId);  // Logging feature ID for debugging

                    if (hoveredStateId !== currentId) {
                        if (hoveredStateId) {
                            map.setFeatureState({source: layerId, id: hoveredStateId}, { hover: false });
                        }
                        hoveredStateId = currentId;
                        map.setFeatureState({source: layerId, id: hoveredStateId}, { hover: true });
                    }
//for the pop ups first grab the properties from the geojson files: 
                    const name = feature.properties['NAME'] || feature.properties['NAMELSAD'];
                    const voterPower = feature.properties['voter_power'] === undefined ? 'no race' : feature.properties['voter_power'];
                    const voterPowerhouse = feature.properties['voter_power'];
                    const cookRating = feature.properties['voter_power'];
                    const candidateNameR = feature.properties['R_running'] || 'Not available';
                    const candidateNameD = feature.properties['D_running'] || 'Not available';
                    const ballotname = feature.properties['name.of.ballot'] || 'Not available';
                    const statename = feature.properties['state_name'] || 'Not available';

                    const description = feature.properties['description'] || 'No liberty ballots';


        let popupContent = '';
//For the detail map I created separate popups for each layer because there were so many layers. Here is where the popup would be updated:
        if (layerId === 'gubernatorial') {
            popupContent = `<div class="custom-popup">
                <strong>State:</strong> ${name}<br>
                <strong>Republican running:</strong> ${candidateNameR}<br>
                <strong>Democrat running:</strong> ${candidateNameD}<br>
                <strong>Voter Power:</strong> ${voterPower}
            </div>`;
        } else if (layerId === 'presidential2') {
           popupContent = `<div class="custom-popup">
            <strong>State:</strong> ${name}<br>
              <strong>Republican running:</strong> ${candidateNameR}<br>
              <strong>Democrat running:</strong> ${candidateNameD}<br>
              <strong>Voter Power:</strong> ${voterPower}
           </div>`;

        } else if (layerId === 'state_leg_up') {
           popupContent = `<div class="custom-popup">
              <strong>District name:</strong> ${name}<br>
              <strong>Republican running:</strong> ${candidateNameR}<br>
              <strong>Democrat running:</strong> ${candidateNameD}<br>
              <strong>Voter Power:</strong> ${voterPower}
           </div>`;

        } else if (layerId === 'state_leg_low') {
           popupContent = `<div class="custom-popup">
              <strong>District name:</strong> ${name}<br>
              <strong>Republican running:</strong> ${candidateNameR}<br>
              <strong>Democrat running:</strong> ${candidateNameD}<br>
              <strong>Voter Power:</strong> ${voterPower}
           </div>`;

        } else if (layerId === 'ballot_abort') {
   
        const ballotMessage = ballotname === 'Not available'
        ? 'No abortion ballots in this state'
        : `<strong>State name:</strong><br>
        ${statename}<br>
        <strong>Ballot name:</strong><br>
        ${ballotname}<br>
        <strong>Abortion ballot description:</strong><br>
        ${description}<br>`;

    popupContent = `<div class="custom-popup">
        ${ballotMessage}
    </div>`;


} else if (layerId === 'ballot_vpm') {
   
   const ballotMessage = ballotname === 'Not available'
   ? 'No voting policy ballots in this state'
   : `<strong>State name:</strong><br>
   ${statename}<br>
   <strong>Ballot name(s):</strong><br>
   ${ballotname}<br>
   <strong>Voting policy ballot description(s):</strong><br>
   ${description}<br>`;

popupContent = `<div class="custom-popup">
   ${ballotMessage}
</div>`;


}
             

     else if (layerId === 'ballot_others') {
   
   const ballotMessage = ballotname === 'Not available'
   ? 'No state-level ballot issues in this state'
   : `<strong>State name:</strong><br>
   ${statename}<br>
   <strong>Ballot or race name(s):</strong><br>
   ${ballotname}<br>
   <strong>Description(s):</strong><br>
   ${description}<br>`;

popupContent = `<div class="custom-popup">
   ${ballotMessage}
</div>`;


}

     else {
            const displayVoterPower = voterPowerhouse === undefined ? 'no competitive race' : voterPowerhouse;

    popupContent = `<div class="custom-popup">
                <strong>${layerId === 'house2' ? 'District' : 'State'}:</strong> ${name}<br>
                <strong>Republican running:</strong> ${candidateNameR}<br>
                <strong>Democrat running:</strong> ${candidateNameD}<br>
                <strong>Voter Power:</strong> ${displayVoterPower}
            </div>`;
        }

            

                    popup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
                    map.getCanvas().style.cursor = 'crosshair';
                } else {
                    if (hoveredStateId) {
                        map.setFeatureState({source: layerId, id: hoveredStateId}, { hover: false });
                        hoveredStateId = null;
                    }
                    map.getCanvas().style.cursor = '';
                    popup.remove();
                }
            });

            map.on('mouseleave', layerId + '-fill', function () {
                if (hoveredStateId) {
                    map.setFeatureState({source: layerId, id: hoveredStateId}, { hover: false });
                    hoveredStateId = null;
                }
                map.getCanvas().style.cursor = '';
                popup.remove();
            });

            // Update the current layer ID
            currentLayerId = layerId;
        }

        

        // Initial layer setup on map load
        map.on('load', function () {
    addGeoJsonLayer('house2');
    
    //filter for only USA names
    const layers = map.getStyle().layers;

    layers.forEach((layer) => {
        const currentFilters = map.getFilter(layer.id);
        
        // if layer includes label or state filter for USA
        if (layer.id.includes('label') || layer.id.includes('state') || layer.id.includes('admin')) {
            if (currentFilters) {
                map.setFilter(layer.id, ['all', currentFilters, ['==', ['get', 'iso_3166_1'], 'US']]);
            } else {
                map.setFilter(layer.id, ['==', ['get', 'iso_3166_1'], 'US']);
            }
        }
    });
});

        document.getElementById('layer').addEventListener('change', function (e) {
            const value = e.target.value;
            if (value in layers) {
                addGeoJsonLayer(value);
            } else {
                Object.keys(layers).forEach(id => {
                    if (map.getLayer(id + '-fill')) {
                        map.removeLayer(id + '-fill');
                        map.removeLayer(id + '-line');
                        map.removeLayer(id + '-hover-line');  // Ensure hover line is also removed
                        map.removeSource(id);
                    }
                });
            }
        });

        // Add mouseenter event to hide map-pop when first entering map

       /* setTimeout(() => {
            document.querySelector('.map-pop').classList.add('hide');
        }, 25000);*/
                </script>
            </div>
        </div>
    </div>

</body>


{% endblock %}
