{% extends "layout.html" %}

{% block title %}
    Address Lookup?????? <br>
{% endblock %}

{% block main %}
<body>
    <label for="location">Your super-detailed specific location information!</label>
    <div class="container-fluid">
        {% for table in tables %}
            {{ table|safe }}
        {% endfor %}
    </div>

    <div class="map-container">
        <div id="geocoder" class="geocoder"></div>
        <div id="map"></div>
    
        <script>
            mapboxgl.accessToken = '{{ mapbox_key }}';
    
            // Initialize the map
            const map = new mapboxgl.Map({
                container: 'map', // Container ID
                style: 'mapbox://styles/mikeklein1/clxkrmlob01s801qkb96q6c00', // Map style URL
                center: [-97.919769, 38.798514], // Starting position [lng, lat]
                zoom: 4, // Starting zoom
                projection: 'globe' // Display the map as a globe
            });
    
            // Add the geocoder control to the map after it has fully loaded
        map.on('load', () => {
            const geocoder = new MapboxGeocoder({
                accessToken: mapboxgl.accessToken,
                mapboxgl: mapboxgl
            });

            document.getElementById('geocoder').appendChild(geocoder.onAdd(map));

            

            // Add the GeoJSON source
            map.addSource('merged_districts', {
                type: 'geojson',
                data: 'data/merged_districts.geojson', // Path to your GeoJSON file
                promoteId: 'NAMELSAD' // Use the appropriate property for unique IDs
            });

            // Add a line layer to outline the districts
            map.addLayer({
                id: 'merged_districts_line',
                type: 'line',
                source: 'merged_districts',
                paint: {
                    'line-color': 'black',
                    'line-width': .5 // Adjust the line width as needed
                }
            }, 'waterway-label'); // Add the new layer before the 'waterway-label' layer or any other layer you want it to be above

            // Make admin-2-boundary and admin-2-boundary-bg layers invisible
            if (map.getLayer('admin-2-boundary')) {
                map.setLayoutProperty('admin-2-boundary', 'visibility', 'none');
            }
            if (map.getLayer('admin-2-boundary-bg')) {
                map.setLayoutProperty('admin-2-boundary-bg', 'visibility', 'none');
            }
        });

        map.on('style.load', () => {
            const layersToFilter = [
                'admin-1-boundary',          // State boundaries
                'admin-1-boundary-bg',       // Background for state boundaries
                'settlement-label',          // General settlement labels
                'settlement-major-label',    // Major city labels
                'settlement-minor-label',    // Minor city labels
                'settlement-subdivision-label', // Subdivision labels (small towns)
                'state-label'                // State labels
            ];

            if (map.getLayer('country-label')) {
                map.removeLayer('country-label');
            }

            layersToFilter.forEach(layerId => {
                if (map.getLayer(layerId)) {
                    map.setFilter(layerId, ['==', ['get', 'iso_3166_1'], 'US']);
                }
            });

            // Hide county boundaries by setting their visibility to none
            if (map.getLayer('admin-2-boundary')) {
                map.setLayoutProperty('admin-2-boundary', 'visibility', 'none');
            }
            if (map.getLayer('admin-2-boundary-bg')) {
                map.setLayoutProperty('admin-2-boundary-bg', 'visibility', 'none');
            }

        });

        map.on('style.load', () => {
    console.log("Current style:", map.getStyle());
});
    
    
        </script>

    </div>
</body>


{% endblock %}
